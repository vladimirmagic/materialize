
<!--  Scripts-->
<script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
<script src="bin/materialize.js"></script>
<script src="docs/js/init.js"></script>

<script>
    document.addEventListener('DOMContentLoaded', () => {

        // HEADER
        function resize () {
            const header = document.querySelector('.header__main');
            if (header) {
                header.style.maxWidth = document.querySelector('header').clientWidth + 'px';
                let previousScroll = 0;
                const top = header.offsetTop;
                const bottom = header.parentNode.offsetHeight;

                document.body.addEventListener('scroll', M.throttle(() => {
                    const currentScroll = document.body.scrollTop;
                    if (currentScroll < previousScroll) {
                        header.classList.remove('sticky-out');
                        if (currentScroll < top * 2) {
                            header.classList.remove('sticky-in');
                        } else if (currentScroll > bottom) {
                            header.classList.add('sticky-in');   
                        }
                    } else if (
                        currentScroll > bottom &&
                        header.classList.contains('sticky-in')
                    ) {
                        header.classList.remove('sticky-in');
                        header.classList.add('sticky-out');
                    }
                    previousScroll = currentScroll;
                }, 200));
            }
        }
        resize();
        window.addEventListener('resize', resize);

        // HEADER ACCOUNT DROPDOWN
        const account = document.querySelectorAll('.header__account');
        M.Dropdown.init(account, { alignment: 'right' });

        // MENU
        const menu = document.querySelector('.header__menu');
        const menuItems = document.querySelectorAll('.header__menu-link');
        if (menu && menuItems) {
            let debounce;

            function menuEnter (e) {
                if (debounce) clearTimeout(debounce);
                debounce = setTimeout(() => {
                    menu.classList.add('active');
                    menuItems.forEach(item => item.classList.remove('active'));
                    e.target.classList.add('active');
                }, 100);
            }

            function menuLeave () {
                menu.classList.remove('active');
                menuItems.forEach(item => item.classList.remove('active'));
            }
            
            menuItems.forEach(item => item.addEventListener('mouseenter', menuEnter));
            menu.addEventListener('mouseleave', menuLeave)
        }

        // SIDENAV
        function onBack () {
            const links = document.querySelector('.sidenav__links');
            if (links) links.focus();
        }
        const back = document.querySelectorAll('.sidenav__menu-back');
        if (back) back.forEach(btn => {
            btn.addEventListener('click', onBack);
        });

        // WHATS NEW
        const whatsnewArrowLeft = document.querySelector('.whatsnew__cards-arrow--left');
        const whatsnewArrowRight = document.querySelector('.whatsnew__cards-arrow--right');
        if (whatsnewArrowLeft && whatsnewArrowRight) {
            function move (forward = true) {
                const cards = document.querySelector('.whatsnew__cards.active .whatsnew__cards-scroll');
                if (cards) {
                    const card1 = cards.querySelector('.card');
                    const card2 = cards.querySelector('.card + .card');
                    if (card1 && card2) {
                        const card = card2.getBoundingClientRect().left - card1.getBoundingClientRect().left; // width from the first card left side to the second card left side
                        const cardsWidth = cards.clientWidth;
                        const cardsCount = Math.floor((cardsWidth + 16) / card);
                        const sign = forward ? 1 : -1;
                        cards.scrollLeft += sign * cardsCount * card;
                    }
                }
            }
            function left () {
                move(false);
            }
            whatsnewArrowLeft.addEventListener('click', left);
            whatsnewArrowRight.addEventListener('click', move);
        }
    });
</script>
